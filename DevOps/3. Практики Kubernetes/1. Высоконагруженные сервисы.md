

# Урок 1. Высоконагруженные сервисы

1. Что такое высоконагруженный сервис
2. Каковы основные отличия высоконагруженных сервисов от обычных
3. Возможности эксплуатации в облаке
# Что такое высоконагруженный сервис

Highload — это приложения с высокой нагрузкой, которая возникает ввиду:

●       большого количества одновременных пользователей (_например: поиск Яндекса_);

●       большого объема данных для обработки (_например: Кинопоиск, Okko и другие стрим-сервисы_);

●       наличия сложных операций, расчетов и запросов к СУБД (_например: приложения банков или интернет-магазинов_).

Ключевое отличие highload-сервисов заключается в последствиях, связанными с отказом подобной **системы** или ее функции. При отказе приложения магазина пользователи не смогут купить товары, а владелец начнет нести убытки за каждую секунду простоя.  
Иными словами, обычный сервис может позволить себе простой без вреда для бизнеса, а highload — нет.

# Особенности highload-приложений

**Жесткость.** Highload характеризуется жесткостью приложений с возможностью изменять некоторые их части.

**Масштабируемость.** Необходимо закрыть вопрос о том, как много людей смогут одновременно пользоваться приложением и сколько информации способна обработать база данных.

**Малое время отклика.** Самое важное в highload-среде — насколько быстро система сможет дать ответ на запрос при таких же параллельных запросах.

**Отказоустойчивость.** Это свойство позволяет системе продолжать работать должным образом в случае отказа одного или нескольких неисправностей в некоторых ее компонентах. Для обеспечения этого свойства хорошо использовать облачные среды – так как на уровне инфраструктуры и сетевой связанности они уже обладают отказоустойчивостью.

# Масштабирование

Основная механика построения highload-сервиса — масштабирование. Возможность к масштабированию должна лежать в основе построения такого сервиса и всех его компонентов, поскольку именно она обеспечивает:

●       эластичность и невосприимчивости сервиса к изменению нагрузки;

●       отказоустойчивость;

●       высокую скорость работы и быстрый отклик системы.

Масштабирование бывает:

**Горизонтальное.** Система разделяется на структурные компоненты. Эти компоненты работают на разных виртуальных машинах. Масштабирование заключается в увеличении количества экземпляров этих компонентов и виртуальных машин без изменения их объемов ресурсов.

**Вертикальное.** Увеличение объема вычислительной мощности отдельных компонентов для повышения производительности. Это самый простой тип масштабирования, он не требует изменений в код приложения, но менее гибкий с точки зрения его небесконечности.

С точки зрения применения масштабирование может быть ручным и автоматическим.

**Автомасштабированием** называется процесс динамического выделения ресурсов в соответствии с требованиями к производительности.

# Требования для higload-приложений

Перейдем к требованиям, предъявляемым при построении highload-приложений.

**Модульность.** При горизонтальном подходе приложение делится на микросервисы, которые разносятся по разным серверам для обеспечения высокой отказоустойчивости и доступности.

**Нагрузка на интеграционный слой.** Чем больше число модулей приложения, тем сильнее придется работать над их межсервисной интеграцией. Нагрузка на этот слой растет пропорционально нагрузке на приложения.

**Дублирование критических узлов.** При работе на высокой нагрузке необходимо иметь дополнительный failover-экземпляр всей структуры приложения для обеспечения высокой доступности.

**Эксклюзивность.** Все приложения, построенные на микросервисной архитектуре под Highload, пишутся с нуля и не имеют возможности переиспользовать ее части. В каждом случае придется строить систему в зависимости от интеграционного слоя и бизнес-логики.

# Сопутствующие тонкости

Построение highload-сервиса — процесс непростой, однако в этом деле есть верные помощники:

●       мониторинг;

●       логирование;

●       интеграционно-функциональное тестирование (ИФТ);

●       нагрузочное и стресс-тестирования (НТ).

# Мониторинг

Мониторинг — это сервис сбора метрик (показателей) работы системы или оборудования, на котором она работает. Давайте посмотрим, зачем он нужен.

**Обеспечивает быстрое реагирование на неполадки системы.** Грамотная система мониторинга поможет рассчитать нагрузку на каждый компонент и предугадать будущие проблемы на этапе тестирования, а также выявить проблемы при эксплуатации сервиса.

**Отражает реальную ситуацию с нагрузкой приложения.** Например, приложение отвечает с задержкой. С помощью мониторинга мы можем узнать, какова нагрузка на железо и понять, как именно решить эту проблему.

**Прогнозирование утилизации ресурсов и своевременное масштабирование системы.** Например, мы знаем, что текущий уровень утилизации составляет около 10%, а также видим актуальное количество сессий. Соответственно, благодаря данным мониторинга мы можем предположить, что удвоение нагрузки не вызовет никаких негативных последствий, а при ее дальнейшем увеличении систему придется масштабировать исходя из изменения показателей.

# Логирование

Логирование — процесс сбора данных от приложения.

**Позволяет собирать ошибки приложений для дальнейшего расследования.** Логирование тесно переплетено с мониторингом, но отвечает не на вопрос «что произошло?», а «почему это произошло?». Логирование значительно ускоряет разбор событий при аварии.

**Помогает отлаживать систему на этапе запуска приложения.** Иногда данные логирования включают в мониторинг и выстраивают на их основе отдельный индикатор, например, количество ошибок веб-сервера в ответ на запросы к нему. Превышение допустимых значений позволяет распознать аномалию в работе приложения и помогает отладить систему еще на этапе запуска приложения.

**Комбинация с мониторингом позволяет отслеживать реальные программные причины перегрузок.** Логирование позволяет сохранять информацию о том, что происходит во время работы приложения. Эти данные могут включать сообщения об ошибках, предупреждения и другие события, которые происходят во время выполнения программы. При перегрузках система логирования может помочь выявить причины подобных проблем. Например, она поможет помочь увидеть, что программа выполняет множество однотипных запросов к базе данных, а значит, выявить причину перегрузки базы данных.

# Интеграционно-функциональное тестирование

При построении highload-сервиса важную роль играют процессы тестирования. Они помогают рассчитать рабочие мощности и обнаружить узкие места приложения.

Интеграционное-функциональное тестирование (ИФТ) — базовый вид тестирования, позволяющий оценить работоспособность функционала сервиса и интеграционных взаимодействий.

**Особенности:**

●       На этапе тестирования позволяет выявить функциональные проблемы не внутри приложений, а на этапе запросов через интеграционный слой.

●       Обычно используется перед запуском нового компонента системы или модернизации старого.

●       Часто сопровождается регрессионным тестированием для предотвращения ошибок на заведомо рабочих компонентах.

ИФТ может быть как ручным, так и автоматизированным с использованием заготовок в виде коллекций запросов. В ряде случаев может быть интегрировано в пайплайн сборки и деплоя приложения.

# Нагрузочное и стресс-тестирование

Нагрузочное и стресс-тестирование — вид тестирования производительности, включающий сбор показателей, определение производительности и времени отклика системы или сервисов в ответ на внешний запрос с целью установления соответствия требованиям.

**Особенности:**

●       Обеспечивает проверку работы приложения в условиях, приближенных к реальным, либо проверку возможностей аппаратных компонентов.

●       На этапе тестирования позволяют выявить пороги работоспособности системы, подтвердить прогнозы или выявить ошибки, допущенные при планировании.

●       Обычно используются перед запуском системы или ее компонента, а также при выявлении просадок.

При нагрузочном тестировании необходимо точно понимать, что мы проверяем и как мы это делаем, что является нормальной работой сервиса или приложения, а что — деградацией. Перед проведением тестирования определяем требования, затем тестируем.

**В чем отличие нагрузочного и стресс-тестирования?**

●       Нагрузочное тестирование позволяет выявить пределы функционирования системы.

●       Стресс-тестирование помогает найти слабые места системы, сломать ее и узнать, как эта система будет работать при отказе тех или иных компонентов.

Как правило, по результатам таких тестов корректируют масштабы приложения или изменяют архитектуру. Оба вида тестирования проводятся на средах, близким к реальным, и используют пусть и синтетическую, но приближенную к реальной нагрузку.

И нагрузочное, и стресс-тестирования обычно проводят перед крупным изменением сервиса либо для выявления ошибок, явно связанных с нагрузкой на него.

# Подведем итоги

●       Highload — это приложения с высокой нагрузкой, которая возникает ввиду большого количества одновременных пользователей, большого объема данных для обработки, наличия сложных операций, расчетов и запросов к СУБД.

●       Highload характеризуется жесткостью приложений, масштабируемостью, быстрым откликом и отказоустойчивостью.

●       Основная механика построения highload-сервиса — масштабирование.

●       Масштабирование бывает горизонтальным (увеличение количества экземпляров компонентов и виртуальных машин без изменения их объемов ресурсов) и вертикальным (увеличение объема вычислительной мощности отдельных компонентов для повышения производительности).

●       С точки зрения применения масштабирование может быть ручным и автоматическим.

●       К highload-приложениям предъявляется ряд требований: модульность, дублирование критических узлов, эксклюзивность, нагрузка на интеграционный слой.

●       Построение высоконагруженных сервисов невозможно без мониторинга, логирования, интеграционно-функционального, нагрузочного и стресс-тестирования.

●       Мониторинг — это сервис сбора метрик (показателей) работы системы или оборудования, на котором она работает. Он обеспечивает быстрое реагирование на неполадки системы, отражает реальную ситуацию с нагрузкой приложения, позволяет спрогнозировать утилизацию ресурсов и своевременное масштабирование системы.

●       Логирование — процесс сбора данных от приложения. Оно позволяет собирать ошибки приложений для дальнейшего расследования, помогает отлаживать систему на этапе запуска приложения, а в комбинации с мониторингом обеспечивает отслеживание реальных программных причин перегрузок.

●       При построении highload-сервиса важную роль играют процессы тестирования.

●       Интеграционное-функциональное тестирование (ИФТ) — базовый вид тестирования, позволяющий оценить работоспособность функционала сервиса и интеграционных взаимодействий.

●       Нагрузочное и стресс-тестирование — тестирование производительности, включающее сбор показателей, определение производительности и времени отклика системы или сервисов в ответ на внешний запрос с целью установления соответствия требованиям. Нагрузочное тестирование позволяет выявить пределы функционирования системы. Стресс-тестирование помогает найти слабые места системы, сломать ее и узнать, как эта система будет работать при отказе тех или иных компонентов.